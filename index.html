<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>부동산 PWA</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js';
    import { getDatabase, ref, push, onValue } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js';

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB1X2Y9K9-dQBDXQ7eVxaGKJDQc_ztdWYs",
      authDomain: "real-estate-app-7a001.firebaseapp.com",
      databaseURL: "https://real-estate-app-7a001-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "real-estate-app-7a001",
      storageBucket: "real-estate-app-7a001.appspot.com",
      messagingSenderId: "229808061189",
      appId: "1:229808061189:web:fa083511b468b44e3556c",
      measurementId: "G-TZ4X11LZ57"
    
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Event listeners for button actions
    document.getElementById('homeBtn').addEventListener('click', () => {
      console.log("Home button clicked");
      // Code to show posts or navigate
    });

    document.getElementById('mapBtn').addEventListener('click', () => {
      console.log("Map button clicked");
      initMap(); // Initialize Google Map
    });

    document.getElementById('chatBtn').addEventListener('click', () => {
      console.log("Chat button clicked");
      // Code to display chat
    });

    document.getElementById('sellBtn').addEventListener('click', () => {
      console.log("Sell button clicked");
      // Code to show sell form
    });

    document.getElementById('buyBtn').addEventListener('click', () => {
      console.log("Buy button clicked");
      // Code to show buy form
    });

    // Google Maps Initialization
    function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 37.5665, lng: 126.9780 }, // Default to Seoul
        zoom: 12,
      });

      // Example posts and their locations on map
      const posts = [
        { lat: 37.5665, lng: 126.9780, title: 'Post 1' }
      ];

      posts.forEach(post => {
        new google.maps.Marker({
          position: { lat: post.lat, lng: post.lng },
          map,
          title: post.title,
        });
      });
    }
  </script>
  <script type="text/javascript" src="https://openapi.naver.com/openapi/v3/maps.js?clientId=4RD2ebOkRyPtW9NdIKy3WHjihdskrZtzz3XfPqKM"></script>
</head>
<body>
  <header>
    <h1>부동산 매물 및 매수자 등록 PWA</h1>
  </header>

  <div id="navbar">
    <button id="homeBtn">🏠 Home</button>
    <button id="mapBtn">🗺️ Map</button>
    <button id="chatBtn">💬 Chat</button>
    <button id="sellBtn">🛒 Sell</button>
    <button id="buyBtn">💰 Buy</button>
  </div>

  <!-- Home Section -->
  <section id="homeSection">
    <h2>매물 등록</h2>
    <form id="매물등록폼">
      <label for="종류">종류:</label>
      <input type="text" id="종류" placeholder="예: 아파트">
      <label for="가격">가격 (만원):</label>
      <input type="number" id="가격" placeholder="예: 50000">
      <label for="주소">주소:</label>
      <input type="text" id="주소" placeholder="예: 서울시 종로구 새문안로 68">
      <button type="submit">등록</button>
    </form>
  </section>

  <!-- Sell Section -->
  <section id="sellSection">
    <h2>Sell Property</h2>
    <form id="sellForm">
      <label for="itemType">Item Type:</label>
      <input type="text" id="itemType" placeholder="E.g. Apartment">
      <label for="price">Price (만원):</label>
      <input type="number" id="price" placeholder="E.g. 50000">
      <label for="address">Address:</label>
      <input type="text" id="address" placeholder="E.g. 서울시 강남구 테헤란로 456">
      <button type="submit">Register</button>
    </form>
  </section>

  <!-- Buy Section -->
  <section id="buySection">
    <h2>Buy Property</h2>
    <form id="buyForm">
      <label for="buyType">Item Type:</label>
      <input type="text" id="buyType" placeholder="E.g. Apartment">
      <label for="maxPrice">Max Price (만원):</label>
      <input type="number" id="maxPrice" placeholder="E.g. 60000">
      <label for="buyAddress">Preferred Address:</label>
      <input type="text" id="buyAddress" placeholder="E.g. 서울시 강남구 테헤란로 456">
      <button type="submit">Register</button>
    </form>
  </section>

  <!-- Map Section -->
  <section id="mapSection">
    <div id="map" style="height: 400px;"></div>
  </section>

  <!-- Chat Section -->
  <section id="chatSection">
    <h2>Chat</h2>
    <div id="chatList"></div>
  </section>

  <!-- Display Posts -->
  <section id="postsSection">
    <h2>등록된 매물</h2>
    <ul id="매물목록"></ul>
    <h2>등록된 매수자</h2>
    <ul id="매수자목록"></ul>
  </section>

  <footer>
    <p>© 2025 부동산 PWA</p>
  </footer>

  <script type="module">
    // Firebase Logic for submitting forms
    document.getElementById('sellForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const itemType = document.getElementById('itemType').value;
      const price = document.getElementById('price').value;
      const address = document.getElementById('address').value;

      const sellRef = ref(db, '매물');
      push(sellRef, { itemType, price, address })
        .then(() => {
          alert('Item successfully posted for sale!');
          document.getElementById('sellForm').reset();
        })
        .catch((error) => console.error('Error posting item for sale:', error));
    });

    document.getElementById('buyForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const buyType = document.getElementById('buyType').value;
      const maxPrice = document.getElementById('maxPrice').value;
      const buyAddress = document.getElementById('buyAddress').value;

      const buyRef = ref(db, '매수자');
      push(buyRef, { buyType, maxPrice, buyAddress })
        .then(() => {
          alert('Buy request successfully posted!');
          document.getElementById('buyForm').reset();
        })
        .catch((error) => console.error('Error posting buy request:', error));
    });

    // Fetch and Display Posts
    const 매물Ref = ref(db, '매물');
    onValue(매물Ref, (snapshot) => {
      const data = snapshot.val();
      const 매물목록 = document.getElementById('매물목록');
      매물목록.innerHTML = ''; // Clear the list before adding new posts

      if (data) {
        Object.values(data).forEach((item) => {
          const listItem = document.createElement('li');
          listItem.textContent = `${item.itemType} - ${item.price}만원 - ${item.address}`;
          매물목록.appendChild(listItem);
        });
      }
    });

    const 매수자Ref = ref(db, '매수자');
    onValue(매수자Ref, (snapshot) => {
      const data = snapshot.val();
      const 매수자목록 = document.getElementById('매수자목록');
      매수자목록.innerHTML = ''; // Clear the list before adding new posts

      if (data) {
        Object.values(data).forEach((item) => {
          const listItem = document.createElement('li');
          listItem.textContent = `${item.buyType} - 최대 ${item.maxPrice}만원 - ${item.buyAddress}`;
          매수자목록.appendChild(listItem);
        });
      }
    });
  </script>
</body>
</html>
