<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¶€ë™ì‚° PWA</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js';
    import { getDatabase, ref, push, onValue } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js';

    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID",
        measurementId: "YOUR_MEASUREMENT_ID"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Event listeners for button actions
    document.getElementById('homeBtn').addEventListener('click', () => {
      console.log("Home button clicked");
      // Code to show posts or navigate
    });

    document.getElementById('mapBtn').addEventListener('click', () => {
      console.log("Map button clicked");
      initMap(); // Initialize Google Map
    });

    document.getElementById('chatBtn').addEventListener('click', () => {
      console.log("Chat button clicked");
      // Code to display chat
    });

    document.getElementById('sellBtn').addEventListener('click', () => {
      console.log("Sell button clicked");
      // Code to show sell form
    });

    document.getElementById('buyBtn').addEventListener('click', () => {
      console.log("Buy button clicked");
      // Code to show buy form
    });

    // Google Maps Initialization
    function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 37.5665, lng: 126.9780 }, // Default to Seoul
        zoom: 12,
      });

      // Example posts and their locations on map
      const posts = [
        { lat: 37.5665, lng: 126.9780, title: 'Post 1' }
      ];

      posts.forEach(post => {
        new google.maps.Marker({
          position: { lat: post.lat, lng: post.lng },
          map,
          title: post.title,
        });
      });
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAK8ej_VB7StmK2IOqN7Q37BRIiAQ41ULc&callback=initMap"></script>
</head>
<body>
  <header>
    <h1>ë¶€ë™ì‚° ë§¤ë¬¼ ë° ë§¤ìˆ˜ì ë“±ë¡ PWA</h1>
  </header>

  <div id="navbar">
    <button id="homeBtn">ğŸ  Home</button>
    <button id="mapBtn">ğŸ—ºï¸ Map</button>
    <button id="chatBtn">ğŸ’¬ Chat</button>
    <button id="sellBtn">ğŸ›’ Sell</button>
    <button id="buyBtn">ğŸ’° Buy</button>
  </div>

  <!-- Home Section -->
  <section id="homeSection">
    <h2>ë§¤ë¬¼ ë“±ë¡</h2>
    <form id="ë§¤ë¬¼ë“±ë¡í¼">
      <label for="ì¢…ë¥˜">ì¢…ë¥˜:</label>
      <input type="text" id="ì¢…ë¥˜" placeholder="ì˜ˆ: ì•„íŒŒíŠ¸">
      <label for="ê°€ê²©">ê°€ê²© (ë§Œì›):</label>
      <input type="number" id="ê°€ê²©" placeholder="ì˜ˆ: 50000">
      <label for="ì£¼ì†Œ">ì£¼ì†Œ:</label>
      <input type="text" id="ì£¼ì†Œ" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ìƒˆë¬¸ì•ˆë¡œ 68">
      <button type="submit">ë“±ë¡</button>
    </form>
  </section>

  <!-- Sell Section -->
  <section id="sellSection">
    <h2>Sell Property</h2>
    <form id="sellForm">
      <label for="itemType">Item Type:</label>
      <input type="text" id="itemType" placeholder="E.g. Apartment">
      <label for="price">Price (ë§Œì›):</label>
      <input type="number" id="price" placeholder="E.g. 50000">
      <label for="address">Address:</label>
      <input type="text" id="address" placeholder="E.g. ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 456">
      <button type="submit">Register</button>
    </form>
  </section>

  <!-- Buy Section -->
  <section id="buySection">
    <h2>Buy Property</h2>
    <form id="buyForm">
      <label for="buyType">Item Type:</label>
      <input type="text" id="buyType" placeholder="E.g. Apartment">
      <label for="maxPrice">Max Price (ë§Œì›):</label>
      <input type="number" id="maxPrice" placeholder="E.g. 60000">
      <label for="buyAddress">Preferred Address:</label>
      <input type="text" id="buyAddress" placeholder="E.g. ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 456">
      <button type="submit">Register</button>
    </form>
  </section>

  <!-- Map Section -->
  <section id="mapSection">
    <div id="map" style="height: 400px;"></div>
  </section>

  <!-- Chat Section -->
  <section id="chatSection">
    <h2>Chat</h2>
    <div id="chatList"></div>
  </section>

  <!-- Display Posts -->
  <section id="postsSection">
    <h2>ë“±ë¡ëœ ë§¤ë¬¼</h2>
    <ul id="ë§¤ë¬¼ëª©ë¡"></ul>
    <h2>ë“±ë¡ëœ ë§¤ìˆ˜ì</h2>
    <ul id="ë§¤ìˆ˜ìëª©ë¡"></ul>
  </section>

  <footer>
    <p>Â© 2025 ë¶€ë™ì‚° PWA</p>
  </footer>

  <script type="module">
    // Firebase Logic for submitting forms
    document.getElementById('sellForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const itemType = document.getElementById('itemType').value;
      const price = document.getElementById('price').value;
      const address = document.getElementById('address').value;

      const sellRef = ref(db, 'ë§¤ë¬¼');
      push(sellRef, { itemType, price, address })
        .then(() => {
          alert('Item successfully posted for sale!');
          document.getElementById('sellForm').reset();
        })
        .catch((error) => console.error('Error posting item for sale:', error));
    });

    document.getElementById('buyForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const buyType = document.getElementById('buyType').value;
      const maxPrice = document.getElementById('maxPrice').value;
      const buyAddress = document.getElementById('buyAddress').value;

      const buyRef = ref(db, 'ë§¤ìˆ˜ì');
      push(buyRef, { buyType, maxPrice, buyAddress })
        .then(() => {
          alert('Buy request successfully posted!');
          document.getElementById('buyForm').reset();
        })
        .catch((error) => console.error('Error posting buy request:', error));
    });

    // Fetch and Display Posts
    const ë§¤ë¬¼Ref = ref(db, 'ë§¤ë¬¼');
    onValue(ë§¤ë¬¼Ref, (snapshot) => {
      const data = snapshot.val();
      const ë§¤ë¬¼ëª©ë¡ = document.getElementById('ë§¤ë¬¼ëª©ë¡');
      ë§¤ë¬¼ëª©ë¡.innerHTML = ''; // Clear the list before adding new posts

      if (data) {
        Object.values(data).forEach((item) => {
          const listItem = document.createElement('li');
          listItem.textContent = `${item.itemType} - ${item.price}ë§Œì› - ${item.address}`;
          ë§¤ë¬¼ëª©ë¡.appendChild(listItem);
        });
      }
    });

    const ë§¤ìˆ˜ìRef = ref(db, 'ë§¤ìˆ˜ì');
    onValue(ë§¤ìˆ˜ìRef, (snapshot) => {
      const data = snapshot.val();
      const ë§¤ìˆ˜ìëª©ë¡ = document.getElementById('ë§¤ìˆ˜ìëª©ë¡');
      ë§¤ìˆ˜ìëª©ë¡.innerHTML = ''; // Clear the list before adding new posts

      if (data) {
        Object.values(data).forEach((item) => {
          const listItem = document.createElement('li');
          listItem.textContent = `${item.buyType} - ìµœëŒ€ ${item.maxPrice}ë§Œì› - ${item.buyAddress}`;
          ë§¤ìˆ˜ìëª©ë¡.appendChild(listItem);
        });
      }
    });
  </script>
</body>
</html>
