<!DOCTYPE html> 

 <html lang="ko"> 

 <head> 

  <meta charset="UTF-8"> 

  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>ë¶€ë™ì‚° PWA</title> 



  <!-- Naver Maps API Script (Place this above your custom JavaScript) --> 


  <title>ê°„ë‹¨í•œ ì§€ë„ í‘œì‹œí•˜ê¸°</title>
  <script type="text/javascript"
      src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=g1751tw37y"></script>
  </head>
  <body>
      <div id="map" style="width: 100%; height: 400px;"></div>
  
      <script>
          // html5 geoLocation ê°ì²´ ì‚¬ìš©
          function onGeolocationSuccess(position) {
              // ì¢Œí‘œ ì¶œë ¥ 
              console.log("lat: " + position.coords.latitude + ", lon: " + position.coords.longitude);
              //Naver ì§€ë„ API
              var mapOptions = {
                  center : new naver.maps.LatLng(position.coords.latitude, position.coords.longitude),
                  zoom : 20
              };
  
              var map = new naver.maps.Map('map', mapOptions); // ì‹¤ì œ ì§€ë„ë¥¼ ê°€ì ¸ì˜¤ê¸°
  
              var marker = new naver.maps.Marker({
                  position: new naver.maps.LatLng(position.coords.latitude, position.coords.longitude),
                  map: map,
                  icon: {
                      url: '../img/marker.png',
                      size: new naver.maps.Size(100, 100),
                      origin: new naver.maps.Point(0, 0),
                      anchor: new naver.maps.Point(50, 26)
                  }
  
  
              });
  
          }
          function onGeolocationFail(error) {
              // ì—ëŸ¬ ì¶œë ¥ 
              console.log("Error Code: " + error.code + ", Error Description: "
                      + error.message);
          }
  
          if (navigator.geolocation) { // ì´ ë¸Œë¼ìš°ì €ì—ì„œ geolocationì„ ì§€ì›í•˜ë©´(ê°ì²´ê°€ ìˆìœ¼ë©´)
  
              var positionOptions = {
                  enableHighAccuracy : true, // ì •í™•í•œ ìœ„ì¹˜ ì‚¬ìš© 
                  maximumAge : 0, // ìºì‹œ ì‚¬ìš© ì•ˆí•¨ 
                  timeout : 3000 // timeout 3ì´ˆ (3000ms)ë™ì•ˆ ë°˜ì‘ì—†ìœ¼ë©´ ëë‚´ê¸° 
              };
              navigator.geolocation.getCurrentPosition( // ìœ„, ê²½ë„ë¥¼ ì–»ì–´ë¼ 
                      onGeolocationSuccess, // ì„±ê³µì‹œ function, ìœ„ì—ì„œ ì •ì˜í•œ onGeolocationSuccessí•¨ìˆ˜ë¥¼ ìˆ˜í–‰
                      onGeolocationFail, // Errorì‹œ function
                      positionOptions);  // ì˜µì…˜(ìë°”ìŠ¤í¬ë¦½íŠ¸ê°ì²´)
          }
  
  
      </script>

  <style> 

   /* Basic styles to get started */ 

   body { 

    margin: 0; 

    padding: 20px; 

    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; 

   } 



   header { 

    text-align: center; 

    margin-bottom: 20px; 

   } 



   #navbar { 

    display: flex; 

    justify-content: space-around; 

    margin-bottom: 20px; 

    padding: 10px; 

    background-color: #f0f0f0; 

   } 



   button { 

    padding: 10px 20px; 

    border: none; 

    border-radius: 5px; 

    background-color: #007bff; 

    color: white; 

    cursor: pointer; 

   } 



   button:hover { 

    background-color: #0056b3; 

   } 



   form { 

    display: flex; 

    flex-direction: column; 

    gap: 10px; 

    max-width: 500px; 

    margin: 0 auto; 

   } 



   input { 

    padding: 8px; 

    border: 1px solid #ddd; 

    border-radius: 4px; 

   } 



   #map { 

    width: 100%; 

    height: 400px; 

    margin-top: 20px; 

    border: 1px solid #ddd; 

   } 



   section { 

    margin-bottom: 30px; 

   } 

  </style> 

 </head> 

 <body> 

  <header> 

   <h1>ë¶€ë™ì‚° ë§¤ë¬¼ ë° ë§¤ìˆ˜ì ë“±ë¡</h1> 

  </header> 



  <div id="navbar"> 

   <button id="homeBtn">ğŸ  í™ˆ</button> 

   <button id="mapBtn">ğŸ—ºï¸ ì§€ë„</button> 

   <button id="sellBtn">ğŸ¢ ë§¤ë¬¼ë“±ë¡</button> 

   <button id="buyBtn">ğŸ” ë§¤ìˆ˜ë“±ë¡</button> 

  </div> 



  <section id="homeSection"> 

   <h2>ìµœê·¼ ë“±ë¡ ë§¤ë¬¼</h2> 

   <div id="recentListings"> 

    <!-- Recent listings will be populated here --> 

   </div> 

  </section> 



  <section id="sellSection" style="display: none;"> 

   <h2>ë§¤ë¬¼ ë“±ë¡</h2> 

   <form id="sellForm"> 

    <label for="itemType">ì¢…ë¥˜:</label> 

    <input type="text" id="itemType" placeholder="ì˜ˆ: ì•„íŒŒíŠ¸" required> 

     

    <label for="price">ê°€ê²© (ë§Œì›):</label> 

    <input type="number" id="price" placeholder="ì˜ˆ: 50000" required> 

     

    <label for="address">ì£¼ì†Œ:</label> 

    <input type="text" id="address" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ìƒˆë¬¸ì•ˆë¡œ 68" required> 

     

    <button type="submit">ë“±ë¡í•˜ê¸°</button> 

   </form> 

  </section> 



  <section id="buySection" style="display: none;"> 

   <h2>ë§¤ìˆ˜ ë“±ë¡</h2> 

   <form id="buyForm"> 

    <label for="buyType">ì°¾ëŠ” ë§¤ë¬¼ ì¢…ë¥˜:</label> 

    <input type="text" id="buyType" placeholder="ì˜ˆ: ì•„íŒŒíŠ¸" required> 

     

    <label for="maxPrice">í¬ë§ ìµœëŒ€ê°€ê²© (ë§Œì›):</label> 

    <input type="number" id="maxPrice" placeholder="ì˜ˆ: 50000" required> 

     

    <label for="buyAddress">í¬ë§ ì§€ì—­:</label> 

    <input type="text" id="buyAddress" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ì¢…ë¡œêµ¬" required> 

     

    <button type="submit">ë“±ë¡í•˜ê¸°</button> 

   </form> 

  </section> 



  <section id="mapSection" style="display: none;"> 

   <div id="map"></div> 

  </section> 



  <!-- Firebase SDK (Modular) --> 

  <script type="module"> 

   import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js'; 

   import { getDatabase, ref, push, onValue } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js'; 



   // Firebase Configuration 

   const firebaseConfig = { 

    apiKey: "AIzaSyB1X2Y9K9-dQBDXQ7eVxaGKJDQc_ztdWYs", 

    authDomain: "real-estate-app-7a001.firebaseapp.com", 

    databaseURL: "https://real-estate-app-7a001-default-rtdb.asia-southeast1.firebasedatabase.app", 

    projectId: "real-estate-app-7a001", 

    storageBucket: "real-estate-app-7a001.appspot.com", 

    messagingSenderId: "229808061189", 

    appId: "1:229808061189:web:fa083511b468b44e3556c" 

   }; 



   // Initialize Firebase 

   const app = initializeApp(firebaseConfig); 

   const db = getDatabase(app); 



   // Section management 

   const sections = { 

    homeSection: document.getElementById('homeSection'), 

    sellSection: document.getElementById('sellSection'), 

    buySection: document.getElementById('buySection'), 

    mapSection: document.getElementById('mapSection') 

   }; 



   function showSection(sectionId) { 

    Object.entries(sections).forEach(([id, element]) => { 

     element.style.display = id === sectionId ? 'block' : 'none'; 

    }); 

    if (sectionId === 'mapSection') { 

     initMap(); 

    } 

   } 



   // Navigation 

   document.getElementById('homeBtn').addEventListener('click', () => showSection('homeSection')); 

   document.getElementById('mapBtn').addEventListener('click', () => showSection('mapSection')); 

   document.getElementById('sellBtn').addEventListener('click', () => showSection('sellSection')); 

   document.getElementById('buyBtn').addEventListener('click', () => showSection('buySection')); 



   // Map initialization 

   let map = null; 

   function initMap() { 

    if (!map) { 

     map = new naver.maps.Map('map', { 

      center: new naver.maps.LatLng(37.5665, 126.9780), // Seoul 

      zoom: 12 

     }); 

    } 

   } 



   // Form handlers 

   document.getElementById('sellForm').addEventListener('submit', async (e) => { 

    e.preventDefault(); 

    try { 

     const data = { 

      itemType: document.getElementById('itemType').value, 

      price: parseInt(document.getElementById('price').value), 

      address: document.getElementById('address').value, 

      timestamp: Date.now() 

     }; 

      

     await push(ref(db, 'ë§¤ë¬¼'), data); 

     alert('ë§¤ë¬¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!'); 

     e.target.reset(); 

     showSection('homeSection'); 

    } catch (error) { 

     console.error('Error posting item:', error); 

     alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); 

    } 

   }); 



   document.getElementById('buyForm').addEventListener('submit', async (e) => { 

    e.preventDefault(); 

    try { 

     const data = { 

      buyType: document.getElementById('buyType').value, 

      maxPrice: parseInt(document.getElementById('maxPrice').value), 

      buyAddress: document.getElementById('buyAddress').value, 

      timestamp: Date.now() 

     }; 

      

     await push(ref(db, 'ë§¤ìˆ˜ì'), data); 

     alert('ë§¤ìˆ˜ ìš”ì²­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!'); 

     e.target.reset(); 

     showSection('homeSection'); 

    } catch (error) { 

     console.error('Error posting buy request:', error); 

     alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); 

    } 

   }); 



   // Load recent listings 

   function updateRecentListings() { 

    const listingsRef = ref(db, 'ë§¤ë¬¼'); 

    onValue(listingsRef, (snapshot) => { 

     const listings = snapshot.val(); 

     const recentListingsDiv = document.getElementById('recentListings'); 

     recentListingsDiv.innerHTML = ''; 

      

     if (listings) { 

      Object.entries(listings).reverse().slice(0, 5).forEach(([key, data]) => { 

       const listingDiv = document.createElement('div'); 

       // Check for undefined and format 

       const price = data.price; 

       const formattedPrice = price !== undefined && price !== null ? price.toLocaleString() : 'N/A'; 

       listingDiv.innerHTML = `  

        <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;"> 

         <h3>${data.itemType}</h3> 

         <p>ê°€ê²©: ${formattedPrice}ë§Œì›</p> 

         <p>ì£¼ì†Œ: ${data.address}</p> 

        </div> 

       `; 

       recentListingsDiv.appendChild(listingDiv); 

      }); 

     } 

    }); 

   } 



   // Initialize the app 

   updateRecentListings(); 

   showSection('homeSection'); 

  </script> 

 </body> 

 </html>